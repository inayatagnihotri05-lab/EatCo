<!--
The Climate Finance Simulator â€” FULL REBUILD (Dystopian Neon Green)
Save as: climate-finance-simulator.html

Features included in this full rebuild:
- Neon animated background with green cyber glow
- Mobile-first responsive layout and swipe/tap interactions
- Expanded investment universe (solar, EV, organic, water, plant-based, carbon credits, algae farms, vertical farms, lab meat, green bonds)
- Story Mode (3 missions, narrative choices, progression, XP and ranks)
- Disaster engine (drought, heatwave, crop disease, market crash, policy ban, tech breakthrough)
- Glossary / Real-life finance term explanations (ROI, diversification, ETFs, green bonds, carbon markets, risk tolerance)
- Animated score bars, animated neon counters
- Dark-mode toggle preserved (will follow neon theme)
- Save / view past portfolios via localStorage (history viewer)
- Share image generator for social
- Analytics-ready (simple console hooks to integrate external analytics)
- All code uses plain HTML/CSS/JS â€” no external libraries

Customize values in the INVESTMENTS, EVENTS, MISSIONS arrays at the top of the script.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Climate Finance Simulator | EatCo</title>
  <style>
    /* ------------------ THEME & NEON BG ------------------ */
    :root{
      --bg:#050608; --panel:#0b0d0f; --neon:#00ff88; --neon-2:#19e6a3; --muted:#9fb3ad; --glass:rgba(255,255,255,0.03);
      --danger:#ff6b6b; --glass-2:rgba(0,255,136,0.04);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:#040506; color:#d8efe6;}

    /* animated neon grid background */
    body::before{
      content:''; position:fixed; inset:0; background:radial-gradient(circle at 10% 20%, rgba(0,255,136,0.03), transparent 10%),
        radial-gradient(circle at 90% 80%, rgba(0,255,120,0.02), transparent 10%), linear-gradient(180deg,#00120b, #021212 40%);
      z-index:-4; opacity:1;
    }
    .neon-grid{position:fixed; inset:0; background-image:linear-gradient(rgba(0,255,136,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,255,136,0.02) 1px, transparent 1px); background-size:120px 120px; z-index:-3; animation:glow 6s infinite alternate;}
    @keyframes glow{from{opacity:0.25; filter:brightness(0.9)} to{opacity:0.6; filter:brightness(1.05) saturate(1.2)}}

    /* container */
    .container{max-width:1200px; margin:36px auto; padding:18px; display:grid; grid-template-columns:360px 1fr; gap:20px}
    header{grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{font-weight:800; color:var(--neon); letter-spacing:1px}
    .subtitle{color:var(--muted); font-size:13px}

    /* left panel */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2)); border-radius:14px; padding:16px; border:1px solid rgba(0,255,136,0.05); box-shadow:0 8px 40px rgba(0,0,0,0.6)}
    .stats{display:grid; grid-template-columns:repeat(2,1fr); gap:10px}
    .stat{padding:12px; background:rgba(0,0,0,0.25); border-radius:10px}
    .stat h4{margin:0; color:var(--muted); font-size:12px}
    .stat .value{font-size:18px; font-weight:700; color:var(--neon)}

    .invest-grid{display:grid; grid-template-columns:1fr; gap:10px; margin-top:12px}
    .choice-card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06)); padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(0,255,136,0.03)}
    .choice-left{display:flex; gap:10px; align-items:center}
    .choice-left .tag{font-size:20px}
    .choice-left h3{margin:0; font-size:15px}
    .choice-left p{margin:0; color:var(--muted); font-size:12px}
    .choice-actions{display:flex; gap:8px; align-items:center}
    .btn{background:transparent; border:1px solid rgba(0,255,136,0.12); padding:8px 10px; border-radius:8px; color:var(--neon); font-weight:700; cursor:pointer}
    .btn.ghost{background:transparent}
    .btn.primary{background:linear-gradient(90deg, rgba(0,255,136,0.14), rgba(25,230,163,0.06)); border:1px solid rgba(0,255,136,0.12)}

    .log{margin-top:12px; max-height:180px; overflow:auto; font-size:13px; color:var(--muted)}

    /* right panel */
    .play-panel{display:flex; flex-direction:column; gap:12px}
    .panel-large{padding:16px; border-radius:14px; background:linear-gradient(90deg, rgba(0,0,0,0.15), rgba(0,0,0,0.05)); border:1px solid rgba(0,255,136,0.03)}
    .meters{display:flex; gap:10px}
    .meter{flex:1}
    .meter h4{margin:0; color:var(--muted); font-size:12px}
    .bar{height:14px; background:rgba(255,255,255,0.04); border-radius:8px; margin-top:8px; overflow:hidden}
    .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--neon), var(--neon-2)); transition:width 1s ease}

    .spark{height:160px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,0.06); font-size:14px}

    .badge{margin-top:8px; padding:12px; border-radius:10px; text-align:center}
    .badge .title{font-weight:900; color:var(--neon)}

    /* popup & glossary */
    .popup{position:fixed; left:50%; top:10%; transform:translateX(-50%); width:640px; max-width:96%; background:linear-gradient(180deg,#071018,#0a0d0f); padding:18px; border-radius:12px; box-shadow:0 30px 80px rgba(0,0,0,0.7); display:none; z-index:9999; border:1px solid rgba(0,255,136,0.06)}
    .popup h3{margin:0; color:var(--neon)}
    .popup p{color:var(--muted); margin-top:8px; white-space:pre-wrap}
    .close-row{display:flex; justify-content:flex-end; margin-top:12px}

    /* mobile */
    @media(max-width:880px){
      .container{grid-template-columns:1fr; padding:12px}
      .brand .subtitle{display:none}
      .stats{grid-template-columns:repeat(3,1fr)}
      .spark{height:120px}
      header{flex-direction:column; align-items:flex-start; gap:6px}
    }

    @media(max-width:480px){
      .stats{grid-template-columns:repeat(2,1fr)}
      .choice-actions{flex-direction:column; width:140px}
      .choice-left h3{font-size:14px}
    }

    /* dark-mode class tweaks */
    body.dark-mode{background:#030405}

    /* swipe animation hint */
    .swipe-left{transform:translateX(-120%); opacity:0; transition:transform .5s ease, opacity .5s}
    .swipe-right{transform:translateX(120%); opacity:0; transition:transform .5s ease, opacity .5s}

    /* --- FOG BACKGROUND --- */
  .fog {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    background: url('https://i.imgur.com/8Iltu8m.png');
    opacity: 0.12;
    animation: fogMove 40s linear infinite;
    z-index: -1;
  }
  @keyframes fogMove {
    0% { transform: translateX(-10%) translateY(0); }
    50% { transform: translateX(10%) translateY(3%); }
    100% { transform: translateX(-10%) translateY(0); }
  }
</style>
</head>
<body>
<div class="fog"></div>>
  <div class="neon-grid"></div>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">âŸ¡ EatCo</div>
        <div class="subtitle">â€” The Climate Finance Simulator</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <div style="color:var(--muted); font-size:13px">Start with:</div>
        <div class="stat" style="padding:6px 10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.02)"><strong id="cashTop">â‚¹1,000</strong></div>
        <button class="btn" id="glossaryBtn">Glossary</button>
        <button class="btn primary" id="storyBtn">Story Mode</button>
      </div>
    </header>

    <!-- LEFT -->
    <aside class="panel">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
        <div>
          <h3 style="margin:0; font-size:16px; color:var(--neon)">Portfolio Controls</h3>
          <div style="color:var(--muted); font-size:12px">Tap an investment to commit funds. Swipe on mobile.</div>
        </div>
        <div style="text-align:right">
          <div style="color:var(--muted); font-size:12px">Round</div>
          <div style="font-weight:800; color:var(--neon)" id="roundTop">1/3</div>
        </div>
      </div>

      <div class="stats" style="margin-top:12px">
        <div class="stat"><h4>Cash</h4><div class="value" id="cash">â‚¹1,000</div></div>
        <div class="stat"><h4>Profit</h4><div class="value" id="profitScore">0</div></div>
        <div class="stat"><h4>Emissions</h4><div class="value" id="emissionScore">100</div></div>
        <div class="stat"><h4>Food Sec</h4><div class="value" id="foodScore">50</div></div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px">
        <button class="btn" id="eventBtn">Trigger Event</button>
        <button class="btn" id="saveBtn">Save Portfolio</button>
      </div>

      <div class="invest-grid" id="investGrid" style="margin-top:12px">
        <!-- choices injected here -->
      </div>

      <div class="log" id="logArea"><div style="opacity:0.7">Welcome agent â€” allocate wisely.</div></div>
    </aside>

    <!-- RIGHT -->
    <main class="play-panel">
      <div class="panel-large">
        <div class="meters">
          <div class="meter"><h4>Profit</h4><div class="bar"><i id="profitBar"></i></div></div>
          <div class="meter"><h4>Emissions (lower better)</h4><div class="bar"><i id="emissionBar"></i></div></div>
          <div class="meter"><h4>Food Security</h4><div class="bar"><i id="foodBar"></i></div></div>
        </div>

        <div class="spark" id="spark">Portfolio history will appear here.</div>
        <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
          <div class="badge"><div class="title" id="badgeTitle">Badge: â€”</div><div style="color:var(--muted); font-size:13px" id="badgeDesc">Play to earn ranks & missions.</div></div>
          <div style="margin-left:auto; display:flex; gap:8px"><button class="btn" id="shareBtn">Share</button><button class="btn" id="historyBtn">History</button></div>
        </div>
      </div>

      <div class="panel-large" id="missionPanel">
        <h3 style="margin:0; color:var(--neon)">Mission Log</h3>
        <div id="missionText" style="color:var(--muted); margin-top:8px">No mission active. Enter Story Mode to begin.</div>
      </div>

    </main>
  </div>

  <!-- Glossary / popup -->
  <div class="popup" id="popup">
    <h3 id="popTitle">Title</h3>
    <p id="popBody">Body</p>
    <div class="close-row"><button class="btn" id="popClose">Close</button></div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const STARTING_CASH = 1000; const TOTAL_ROUNDS = 3;

    // Investments extended
    const INVESTMENTS = [
      {id:'solar', name:'Solar Energy', tag:'ðŸŒž', baseCost:300, profit:{mean:180,var:40}, emissions:-28, food:+6, sustain:+18, risk:'Low', teach:'Solar: long-term infrastructure investment â€” steady ROI.'},
      {id:'ev', name:'Electric Vehicles', tag:'ðŸš—', baseCost:250, profit:{mean:120,var:70}, emissions:-25, food:0, sustain:+14, risk:'Medium', teach:'EVs: tech adoption; short-term swings, long-term growth.'},
      {id:'organic', name:'Organic Farming', tag:'ðŸŒ¾', baseCost:220, profit:{mean:110,var:30}, emissions:-12, food:+22, sustain:+16, risk:'Low', teach:'Organic: improves soil & yields; boosts food security.'},
      {id:'water', name:'Water Recycling', tag:'ðŸ’§', baseCost:150, profit:{mean:90,var:10}, emissions:-8, food:+20, sustain:+12, risk:'Very Low', teach:'Water infra: adaptation, steady returns.'},
      {id:'plant', name:'Plant-Based Foods', tag:'ðŸ¥—', baseCost:180, profit:{mean:95,var:15}, emissions:-30, food:+18, sustain:+15, risk:'Very Low', teach:'Plant-based: consumer trend; scalable with demand.'},
      {id:'carbon', name:'Carbon Credits', tag:'ðŸª™', baseCost:200, profit:{mean:70,var:60}, emissions:-50, food:0, sustain:+8, risk:'High', teach:'Carbon credits: pay to cancel emissions â€” volatile market.'},
      {id:'algae', name:'Algae Farms', tag:'ðŸŸ¢', baseCost:160, profit:{mean:80,var:35}, emissions:-20, food:+10, sustain:+12, risk:'Medium', teach:'Algae: biotech food + carbon sequestration potential.'},
      {id:'vertical', name:'Vertical Farming', tag:'ðŸ™ï¸', baseCost:210, profit:{mean:100,var:40}, emissions:-10, food:+25, sustain:+14, risk:'Medium', teach:'Vertical farms: high yields, urban food security.'},
      {id:'labmeat', name:'Lab-Grown Meat', tag:'ðŸ§ª', baseCost:230, profit:{mean:140,var:80}, emissions:-18, food:+12, sustain:+10, risk:'High', teach:'Lab meat: emerging tech â€” high upside, high risk.'},
      {id:'greenbond', name:'Green Bonds', tag:'ðŸ“ˆ', baseCost:200, profit:{mean:60,var:12}, emissions:-5, food:0, sustain:+9, risk:'Low', teach:'Green bonds: debt instruments funding sustainable projects.'}
    ];

    // EVENTS / disasters
    const EVENTS = [
      {id:'drought', title:'Drought', text:'Severe drought hits crops â€” food security falls.', profitAdj:-60, emissionAdj:+6, foodAdj:-22, sustainAdj:-12},
      {id:'heat', title:'Heatwave', text:'A heatwave reduces yields and causes blackouts; tech supply chains hurt.', profitAdj:-40, emissionAdj:+8, foodAdj:-12, sustainAdj:-8},
      {id:'disease', title:'Crop Disease', text:'A fungal outbreak reduces yields of certain crops.', profitAdj:-50, emissionAdj:+4, foodAdj:-18, sustainAdj:-10},
      {id:'crash', title:'Market Crash', text:'A global market crash reduces returns across sectors.', profitAdj:-120, emissionAdj:+10, foodAdj:-6, sustainAdj:-14},
      {id:'policy', title:'Green Subsidy', text:'Government announces a subsidy favouring clean energy and EVs!', profitAdj:+120, emissionAdj:-10, foodAdj:+2, sustainAdj:+10, fav:['solar','ev']},
      {id:'tech', title:'Tech Breakthrough', text:'A breakthrough lowers production costs in a sector.', profitAdj:+90, emissionAdj:-6, foodAdj:+4, sustainAdj:+8, fav:['labmeat','ev']}
    ];

    // Story missions
    const MISSIONS = [
      {id:'m1', title:'Ration & Rebuild', text:'A heatwave hit rural belts. Help stabilise food markets. Goal: raise Food Security by 20.', reward:{cash:180, xp:30}},
      {id:'m2', title:'Grid Recovery', text:'Power shortfalls cripple cities. Support energy projects. Goal: reduce Emissions by 12.', reward:{cash:220, xp:40}},
      {id:'m3', title:'Market Stabiliser', text:'Global crash threatens farmers. Rebalance portfolios. Goal: Profit score +35.', reward:{cash:300, xp:60}}
    ];

    // ---------- STATE ----------
    let state = { cash: STARTING_CASH, round:1, profitScore:0, emissionScore:100, foodScore:50, sustainScore:0, history:[], sparkline:[], xp:0, rank:'Novice' };

    // ---------- UTILS ----------
    const $ = id => document.getElementById(id);
    function randNormal(mean, variance){ const u1=Math.random(), u2=Math.random(); const z0=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2); return Math.max(Math.round(mean + z0*Math.sqrt(variance)), -9999);} 
    function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
    function fmt(v){return 'â‚¹'+Math.round(v);} 

    // ---------- RENDER OPTIONS ----------
    function renderOptions(){ const container = $('investGrid'); container.innerHTML=''; INVESTMENTS.forEach(inv=>{
      const card = document.createElement('div'); card.className='choice-card choice-card-'+inv.id; card.setAttribute('data-id',inv.id);
      card.innerHTML = `<div class="choice-left"><div class="tag">${inv.tag}</div><div><h3>${inv.name}</h3><p>${inv.baseCost ? 'Suggested: â‚¹'+inv.baseCost+' â€¢ Risk: '+inv.risk : ''}</p></div></div><div class="choice-actions"><button class="btn" data-id="${inv.id}">Invest</button><button class="btn" data-info="${inv.id}">Info</button></div>`;
      container.appendChild(card);
    });

      // listeners
      document.querySelectorAll('.choice-card .btn[data-id]').forEach(b=>b.addEventListener('click', e=>invest(e.currentTarget.getAttribute('data-id'))));
      document.querySelectorAll('.choice-card .btn[data-info]').forEach(b=>b.addEventListener('click', e=>{ const id=e.currentTarget.getAttribute('data-info'); const inv=INVESTMENTS.find(x=>x.id===id); showPopup(inv.name, inv.teach); }));

      // mobile swipe gestures
      document.querySelectorAll('.choice-card').forEach(card=>{
        let sX=0,eX=0; card.addEventListener('touchstart',ev=>sX=ev.changedTouches[0].screenX);
        card.addEventListener('touchend',ev=>{ eX=ev.changedTouches[0].screenX; if(eX < sX-70){ card.classList.add('swipe-left'); setTimeout(()=>card.remove(),500); invest(card.getAttribute('data-id')); } if(eX > sX+70){ card.classList.add('swipe-right'); setTimeout(()=>card.remove(),500); showPopup('Quick Invest','Invested via swipe in '+card.querySelector('h3').innerText); invest(card.getAttribute('data-id')); }});
      });
    }

    function log(text){ const area=$('logArea'); const d=document.createElement('div'); d.style.padding='6px 0'; d.innerText=text; area.prepend(d); }

    function updateUI(animate=true){ $('cash').innerText = fmt(state.cash); $('cashTop').innerText = fmt(state.cash); $('roundTop').innerText = state.round+'/'+TOTAL_ROUNDS; $('profitScore').innerText = Math.round(state.profitScore); $('emissionScore').innerText = Math.round(state.emissionScore); $('foodScore').innerText = Math.round(state.foodScore);
      const profitPct = clamp(Math.round((state.profitScore + 200)/4),0,100); const emissionPct = clamp(100 - Math.round(state.emissionScore/1.5),0,100); const foodPct = clamp(Math.round(state.foodScore),0,100);
      if(animate){ animateBar('profitBar', profitPct); animateBar('emissionBar', emissionPct); animateBar('foodBar', foodPct); }
      renderSpark(); updateBadge(); }

    function renderSpark(){ const el=$('spark'); const arr=state.sparkline.slice(-8).map(v=>Math.round(v)); el.innerHTML = arr.length? 'â€¢ '+arr.join(' â€¢ '): 'No history yet'; }

    function updateBadge(){ let badge='Novice'; if(state.xp>50) badge='Adept'; if(state.xp>120) badge='Veteran'; if(state.xp>250) badge='EcoLord'; $('badgeTitle').innerText = 'Rank: '+badge; $('badgeDesc').innerText = 'XP: '+state.xp+' â€¢ Cash: '+fmt(state.cash); }

    function showPopup(title, body){ $('popTitle').innerText=title; $('popBody').innerText=body; $('popup').style.display='block'; }
    $('popClose').addEventListener('click', ()=>{$('popup').style.display='none';});

    // ---------- CORE INVEST ----------
    function invest(invId){ if(state.round > TOTAL_ROUNDS){ log('No rounds left â€” finish to see results.'); return; } const inv = INVESTMENTS.find(i=>i.id===invId); if(!inv) return; const cost = inv.baseCost || 180; // suggested commit
      // simulate return
      const ret = randNormal(inv.profit.mean, inv.profit.var);
      state.cash += ret - cost; state.profitScore += Math.round(ret/10); state.emissionScore += inv.emissions; state.foodScore += inv.food; state.sustainScore += inv.sustain || 0; state.history.push({round:state.round, inv:inv.id, cost, ret}); state.sparkline.push(state.sustainScore);
      log(`Round ${state.round}: Invested â‚¹${cost} in ${inv.name} â†’ returned â‚¹${ret} (P/L: â‚¹${ret-cost})`);
      // teach popup
      setTimeout(()=> showPopup('Market Note', inv.teach + '

Return this round: â‚¹'+ret+' â€¢ You spent: â‚¹'+cost), 250);
      // chance of event
      if(Math.random() < 0.38) triggerRandomEvent(true);
      // advance round
      state.round++; updateUI(); if(state.round > TOTAL_ROUNDS) finishGame(); }

    // ---------- RANDOM EVENTS ----------
    function triggerRandomEvent(hidden=false){ const ev = EVENTS[Math.floor(Math.random()*EVENTS.length)]; state.cash += ev.profitAdj || 0; state.emissionScore += ev.emissionAdj || 0; state.foodScore += ev.foodAdj || 0; state.sustainScore += ev.sustainAdj || 0; if(ev.fav) { log(`Event favours: ${ev.fav.join(', ')}`); } state.sparkline.push(state.sustainScore); log(`EVENT: ${ev.title} â€” ${ev.text}`); if(!hidden) showPopup(ev.title, ev.text); updateUI(); }

    // ---------- FINISH & LESSON ----------
    function finishGame(){ // badge and lesson
      const p=state.profitScore,e=state.emissionScore,s=state.sustainScore,f=state.foodScore; let badge='Bronze Investor'; let desc='Keep learning diversification.'; if(p>120 && e<60 && s>40) { badge='Gold Investor'; desc='High profit + climate impact â€” well balanced.'; } else if(p>60 && s>20 && e<80) { badge='Silver Investor'; desc='Good balance of return and impact.'; } else if(s>70 && e<55) { badge='Eco GOD'; desc='Max climate & food impact â€” legendary.'; }
      $('badgeTitle').innerText = 'Badge: '+badge; $('badgeDesc').innerText = desc + ' â€¢ Final cash: '+fmt(Math.max(0,state.cash)); log('Game finished. '+badge+' â€” '+desc);
      const lesson = generateLesson(); setTimeout(()=> showPopup('Final Lesson', lesson), 600);
      // save auto-summary
      savePortfolio({date:new Date().toISOString(), cash:state.cash, profit:state.profitScore, emissions:state.emissionScore, food:state.foodScore, xp:state.xp, badge});
    }

    function generateLesson(){ const invested=state.history.map(h=>h.inv); const counts=INVESTMENTS.map(i=>({id:i.id,times:invested.filter(x=>x===i.id).length})); const top=counts.sort((a,b)=>b.times-a.times)[0]; const topInv=INVESTMENTS.find(x=>x.id===top.id) || INVESTMENTS[0]; let lesson = `You invested mostly in ${topInv.name}.
Key finance takeaways:
â€¢ ROI â€” Compare returns vs cost over time.
â€¢ Diversification â€” Spread risk across sectors.
â€¢ Externalities â€” Real costs include climate & food impacts.

Your emissions score: ${Math.round(state.emissionScore)}. Try combining Mitigation (Solar/EV) with Adaptation (Water/Vertical/Organic) and Market plays (Plant/Green Bonds).`;
      return lesson; }

    // ---------- GLOSSARY ----------
    const GLOSSARY = {
      'ROI':'Return on Investment â€” money returned compared to the money invested, usually shown as a percentage.',
      'Diversification':'Splitting investments across different assets to reduce risk of large losses.',
      'Green Bonds':'Debt instruments issued to fund environmentally friendly projects; pay interest like normal bonds.',
      'Carbon Markets':'Markets where companies buy/sell carbon credits to offset emissions.',
      'ETF':'Exchange-Traded Fund â€” a basket of securities traded on exchanges; some ETFs track green indexes.',
      'Risk Tolerance':'An investor\'s ability to endure losses or volatility in their portfolio.'
    };

    $('glossaryBtn').addEventListener('click', ()=>{ let body=''; for(const k in GLOSSARY) body+=k+': '+GLOSSARY[k]+'

'; showPopup('Glossary â€” Finance Terms', body); });

    // ---------- STORY MODE ----------
    let currentMission = null; function startStory(){ currentMission = MISSIONS[0]; state.xp=0; state.rank='Novice'; $('missionText').innerText = currentMission.title + '

'+currentMission.text + '

Goal: '+ 'Complete objective to earn rewards.'; log('Story Mode started: '+currentMission.title); showPopup('Story Start', currentMission.text); }
    $('storyBtn').addEventListener('click', ()=>{ startStory(); });

    // Check mission progress (simple checks)
    function checkMissions(){ if(!currentMission) return; if(currentMission.id==='m1' && state.foodScore >= 70){ completeMission(currentMission); } if(currentMission.id==='m2' && state.emissionScore <= 80){ completeMission(currentMission); } if(currentMission.id==='m3' && state.profitScore >= 35){ completeMission(currentMission); } }

    function completeMission(m){ log('Mission Complete: '+m.title); state.cash += m.reward.cash; state.xp += m.reward.xp; state.sustainScore += 8; $('missionText').innerText = 'Completed: '+m.title + ' â€” Rewards received.'; currentMission = MISSIONS[(MISSIONS.indexOf(m)+1) % MISSIONS.length]; updateUI(); showPopup('Mission Complete', 'Rewards: â‚¹'+m.reward.cash+' â€¢ XP: '+m.reward.xp); }

    // ---------- SHARE & SAVE ----------
    function createShareImage(result){ const canvas=document.createElement('canvas'); canvas.width=1080; canvas.height=1080; const c=canvas.getContext('2d'); c.fillStyle='#04100b'; c.fillRect(0,0,1080,1080); c.fillStyle='#00ffb2'; c.font='48px sans-serif'; c.fillText('My Eco Portfolio', 80, 120); c.font='36px sans-serif'; c.fillText('Profit: '+result.profit, 80, 220); c.fillText('Emissions: '+result.emissions, 80, 300); c.fillText('Food: '+result.food, 80, 380); c.fillText('Badge: '+result.badge, 80, 460); const link=document.createElement('a'); link.download='EcoPortfolio.png'; link.href=canvas.toDataURL(); link.click(); }

    function savePortfolio(data){ let history=JSON.parse(localStorage.getItem('ecoPortfolioHistory')||'[]'); history.unshift(data); localStorage.setItem('ecoPortfolioHistory', JSON.stringify(history)); }

    $('saveBtn').addEventListener('click', ()=>{ savePortfolio({date:new Date().toISOString(), cash:state.cash, profit:state.profitScore, emissions:state.emissionScore, food:state.foodScore, xp:state.xp}); alert('Saved to browser history'); });
    $('historyBtn').addEventListener('click', ()=>{ const h=JSON.parse(localStorage.getItem('ecoPortfolioHistory')||'[]'); if(!h.length) return showPopup('History','No saved portfolios yet.'); let out = h.slice(0,8).map(x=>`${new Date(x.date).toLocaleString()}: Cash ${Math.round(x.cash)} â€¢ Profit ${x.profit} â€¢ Emissions ${x.emissions}`).join('

'); showPopup('Saved Portfolios', out); });
    $('shareBtn').addEventListener('click', ()=>{ createShareImage({profit:state.profitScore, emissions:Math.round(state.emissionScore), food:Math.round(state.foodScore), badge:$('badgeTitle').innerText}); });

    // ---------- EVENTS MANUAL BUTTON ----------
    $('eventBtn').addEventListener('click', ()=>{ triggerRandomEvent(false); });

    // ---------- ANIMATIONS & INIT ----------
    function animateBar(id, value){ const bar = $(id); bar.style.width='0%'; setTimeout(()=>{ bar.style.transition='width 1s ease'; bar.style.width = value+'%'; }, 140); }
    function init(){ renderOptions(); updateUI(false); log('Simulator ready â€” Neon mode active.'); }
    init();

    // ---------- QUICK HELP ON LOAD ----------
    window.addEventListener('load', ()=>{ setTimeout(()=> showPopup('Welcome â€” The Climate Finance Simulator','Tap investments to commit. Use Story Mode to play missions. Glossary explains finance terms. Good luck.'),800); });

    // Expose for console / analytics integration
    window.__EATCO_SIM = {state, INVESTMENTS, EVENTS, MISSIONS};
  </script>
</body>
</html>

